# Document Management Specification Delta

## Change: document-management-p1-file-tree-organization

### Requirement: 文件树与章节组织 [MODIFIED]

P1 阶段仅聚焦文件树组织能力，系统必须在左侧文件树面板支持以下行为并保持可测试：

- 拖拽排序：支持同级章节顺序调整，并通过 `file:document:reorder` 持久化。
- 文件夹层级：支持将文档拖入文件夹形成父子关系，并持久化 `parentId` 变化。
- 右键菜单：至少提供重命名、删除、复制、移动到文件夹、标记状态操作入口。
- 键盘导航：支持 Arrow Up/Down、Arrow Left/Right、Enter、F2、Delete。
- 空态：无文档时必须显示空状态文案与新建入口。
- Storybook：必须覆盖多层级默认态、空态、拖拽态、右键菜单态、键盘导航态。

文件树视觉与交互反馈必须遵循 `design/DESIGN_DECISIONS.md` 的 FileTree 相关约束（含尺寸、颜色 token、拖拽态反馈）。

#### Scenario: 用户拖拽调整章节顺序 [MODIFIED]

- **假设** 文件树中同级存在「第一章」「第二章」「第三章」
- **当** 用户将「第三章」拖拽到「第一章」上方
- **则** 拖拽过程中目标位置显示 2px 顺序指示线，拖拽源项显示半透明状态
- **当** 用户释放鼠标
- **则** 文件树顺序更新为「第三章」「第一章」「第二章」
- **并且** 系统通过 `file:document:reorder` 持久化新顺序

#### Scenario: 用户将文档拖入文件夹并维护层级 [MODIFIED]

- **假设** 文件树存在文件夹「第一卷」与文档「番外一」
- **当** 用户将「番外一」拖拽到「第一卷」上
- **则** 目标文件夹在放置区域显示高亮反馈
- **当** 用户释放鼠标
- **则** 「番外一」进入「第一卷」层级并在树结构中可见
- **并且** 系统持久化该文档的 `parentId`

#### Scenario: 用户通过右键菜单执行文件树操作 [ADDED]

- **假设** 用户在文件树中选中文档「未命名章节」
- **当** 用户打开右键菜单
- **则** 菜单包含「重命名」「删除」「复制」「移动到文件夹」「标记状态」操作项
- **当** 用户选择「重命名」并输入「开端」后确认
- **则** 文档标题更新为「开端」
- **并且** 该变更被持久化并反映到文件树显示

#### Scenario: 用户使用键盘导航文件树 [ADDED]

- **假设** 文件树中存在可展开文件夹与多个文档节点
- **当** 用户按 Arrow Down / Arrow Up
- **则** 选择焦点按可见顺序移动
- **当** 用户按 Arrow Right / Arrow Left
- **则** 当前文件夹节点可展开或折叠，且焦点行为可预测
- **并且** Enter 打开当前文档，F2 进入重命名，Delete 触发删除确认

#### Scenario: 文件树空状态 [MODIFIED]

- **假设** 项目中暂无任何文档
- **当** 用户打开文件树面板
- **则** 显示空状态图标与文案「暂无文件，开始创建你的第一个文件」
- **并且** 显示「新建文件」入口用于创建首个文档

#### Scenario: 文件树 Storybook 覆盖 [ADDED]

- **假设** 文件树组件需要可视化验收与回归基线
- **当** 运行 Storybook 场景检查
- **则** 至少存在以下可渲染 story：多层级默认态、空态、拖拽态、右键菜单态、键盘导航态
- **并且** 每个 story 均可在无真实网络/LLM 依赖下独立渲染与回归
