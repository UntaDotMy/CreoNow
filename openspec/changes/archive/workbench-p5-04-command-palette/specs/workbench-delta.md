# Workbench Specification Delta

## Change: workbench-p5-04-command-palette

### Requirement: 命令面板（Command Palette）[MODIFIED]

命令面板搜索结果分类与文件搜索能力补齐：

- 搜索结果**必须**分三类展示 [MODIFIED 补齐实现]：

| 分类     | 数据来源                   | 排序方式         |
| -------- | -------------------------- | ---------------- |
| 最近使用 | localStorage 或 store 记录 | 最近使用时间降序 |
| 文件     | `fileStore.items` 模糊匹配 | 文件名字母序     |
| 命令     | 现有命令列表               | 分组内固定序     |

- 文件项选中后**必须**调用 `editorStore.openDocument` 加载文档 [ADDED]
- 无匹配结果时**必须**显示「未找到匹配结果」[ADDED 实现]
- 最近使用记录上限 20 项，FIFO 淘汰 [ADDED]
- `AppShell` **必须**在运行时动态构建 `commands` prop，注入文件列表和最近使用项 [ADDED]

#### Scenario: 命令面板分类搜索结果 [ADDED]

- **假设** 用户按 `Cmd/Ctrl+P` 打开命令面板
- **当** 搜索框为空
- **则** 结果区展示：最近使用（最多 5 项）、全部命令（按分组）
- **并且** 不展示文件列表（输入后才搜索文件）

#### Scenario: 命令面板文件搜索 [ADDED]

- **假设** 命令面板已打开
- **当** 用户输入「第三章」
- **则** 结果区展示匹配的文件项（group = "文件"）和匹配的命令项
- **并且** 文件项显示文件名和文档类型图标

#### Scenario: 命令面板选中文件打开文档 [ADDED]

- **假设** 命令面板搜索结果包含文件「第三章.md」
- **当** 用户按 Enter 选中该文件
- **则** 调用 `editorStore.openDocument(documentId)` 加载文档
- **并且** 命令面板关闭
- **并且** 该文件加入最近使用记录

#### Scenario: 命令面板无搜索结果 [MODIFIED]

- **假设** 命令面板已打开
- **当** 用户输入一个不匹配任何文件或命令的字符串
- **则** 结果区域显示「未找到匹配结果」
- **并且** 不阻碍用户继续输入或关闭面板

#### Scenario: 命令面板首屏分页 [ADDED]

- **假设** 查询命中超过 100 项
- **当** 命令面板渲染结果
- **则** 首屏仅展示 100 项
- **并且** 滚动到底部时加载下一批（每批 100 项）
- **并且** 输入响应不掉帧

---

## Out of Scope

- CommandPalette 基础 UI 框架修改
- 模糊搜索算法优化（→ workbench-p5-05 性能验收）
- 快捷键自定义
